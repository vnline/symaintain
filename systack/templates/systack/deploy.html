{% extends "systack/base.html" %}{% block title %}游戏装服{% endblock %}{% block mainbar %}    <div class="mainbar">        <div class="page-head">            <h2 class="pull-left"><i class="icon-table"></i>游戏装服</h2>            <!-- Breadcrumb -->            <div class="bread-crumb pull-right">                <a href="/"><i class="icon-home"></i> Home</a>                <span class="divider">/</span>                <a href="/deploy" class="bread-current">Deploy</a>            </div>            <div class="clearfix"></div>        </div>        <div class="matter">            <div class="container">                <!-- Table -->                <div class="row">                    <div class="col-md-12">                        <div class="widget">                            <div class="widget-head">                                <div class="pull-left">Tables</div>                                <div class="widget-icons pull-right">                                    <a href="#" class="wminimize"><i class="icon-chevron-up"></i></a>                                    <a href="#" class="wclose"><i class="icon-remove"></i></a>                                </div>                                <div class="clearfix"></div>                            </div>                            <div class="widget-content">                                <table id="dtable" class="table table-striped table-bordered table-hover">                                    <thead>                                    <tr>                                        <th>#</th>                                        <th>部署服务器</th>                                        <th>部署区服</th>                                        <th>源区服</th>                                        <th>开服时间</th>                                        <th>导入表数据</th>                                        <th>添加中央\管理\GM后台</th>                                        <th>部署人员</th>                                        <th>日志</th>                                    </tr>                                    </thead>                                    <tbody id="dbody">                                    {% if deploys %}                                        {% for list_items in deploys.object_list %}                                            <tr>                                                <td>{{ list_items.id }}</td>                                                <td>{{ list_items.target }}</td>                                                <td class="deploy">{{ list_items.deploy_name }}</td>                                                <td>{{ list_items.prev_name }}</td>                                                <td>{{ list_items.open_time|date:'Y-m-d H:i:s' }}</td>                                                {% if list_items.importdb %}                                                    <td><span class="label label-success">导入</span></td>                                                {% else %}                                                    <td><span class="label label-warning">不导入</span></td>                                                {% endif %}                                                {% if list_items.cgm %}                                                    <td><span class="label label-success">已添加</span></td>                                                {% else %}                                                    <td><span class="label label-warning">未添加</span></td>                                                {% endif %}                                                <td>{{ list_items.deployed_by }}</td>                                                <td>                                                    <button class="btn btn-info chk" >查看日志</button>                                                </td>                                            </tr>                                        {% endfor %}                                    {% endif %}                                    </tbody>                                </table>                                <div class="widget-foot">                                    <ul class="pagination pull-right">                                        {% if deploys.has_previous  %}                                            <li><a href="?page={{ deploys.previous_page_number }}">上一页</a></li>                                        {% endif %}                                        <li><a href="?page={{ deploys.number }}">{{ deploys.number }}</a></li>                                        {% if deploys.has_next %}                                            <li><a href="?page={{ deploys.next_page_number }}">下一页</a></li>                                        {% endif %}                                    </ul>                                </div>                                <div class="clearfix"></div>                                <div class="widget-head">                                    <div class="pull-left">添加开服计划</div>                                    <div class="clearfix"></div>                                </div>                                <div class="padd">                                    {% if form.errors %}                                        <div class="alert alert-error">                                            {{ form.errors }}                                        </div>                                    {% endif %}                                    <div class="form quick-post">                                        <!-- Quick setting form (not working)-->                                        <form class="form-horizontal" id="deploy" action="deploy" method="post">{% csrf_token %}                                            <!-- Name -->                                            <div class="form-group">                                                <label class="control-label col-lg-3" for="target">部署服务器</label>                                                <div class="col-sm-5">                                                    <input type="text" class="form-control" id="target" placeholder="部署服务器" name="target">                                                </div>                                            </div>                                            <div class="form-group">                                                <label class="control-label col-lg-3" for="deploy_name">部署区服</label>                                                <div class="col-sm-5">                                                    <input type="text" class="form-control" id="deploy_name" placeholder="部署区服" name="deploy_name">                                                </div>                                            </div>                                            <div class="form-group">                                                <label class="control-label col-lg-3" for="prev_name">源区服</label>                                                <div class="col-sm-5">                                                    <input type="text" class="form-control" id="prev_name" placeholder="源区服" name="prev_name">                                                </div>                                            </div>                                            <div class="form-group">                                                <label class="control-label col-lg-3" for="open_time">开服时间 </label>                                                <div class="col-sm-5">                                                    <div id="datetimepicker1" class="input-append">                                                        <input data-format="yyyy-MM-dd hh:mm:ss" type="text" class="form-control dtpicker" name="open_time">                                                            <span class="add-on">                                                                <i data-time-icon="icon-time" data-date-icon="icon-calendar" class="btn btn-info btn-lg"></i>                                                            </span>                                                    </div>                                                </div>                                            </div>                                            <!-- importdb -->                                            <div class="form-group">                                                <label class="control-label col-lg-3">导入表数据</label>                                                <div class="col-sm-5">                                                    <div class="make-switch">                                                        <input id="importdb" type="checkbox" name="importdb" checked="checked">                                                    </div>                                                </div>                                            </div>                                            <!-- cgm -->                                            <div class="form-group">                                                <label class="control-label col-lg-3">中央\管理\GM</label>                                                <div class="col-sm-5">                                                    <div class="make-switch">                                                        <input id="cgm" type="checkbox" name="cgm" checked="checked">                                                    </div>                                                </div>                                            </div>                                            <!-- Buttons -->                                            <div class="form-actions">                                                <!-- Buttons -->                                                <button type="reset" class="btn btn-default">重置</button>                                                <button type="submit" class="btn btn-primary" value="submit">提交</button>                                            </div>                                        </form>                                    </div>                                </div>                            </div>                        </div>                    </div>                </div>            </div>        </div>    </div>    <div id="showlog" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">        <div class="modal-dialog">            <div class="modal-content">                <div class="modal-header">                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>                    <h3 id="myModalLabel">日志</h3>                </div>                <div>                    <div id="modal-body" class="modal-body">                    </div>                </div>                <div class="modal-footer">                    <button class="btn btn-danger" data-dismiss="modal" aria-hidden="true">关闭</button>                </div>            </div>        </div>    </div>{% endblock %}{% block js %}    <script type="text/javascript">        $(".form_datetime").datetimepicker({            format: "yyyy-mm-dd hh:ii:ss",            autoclose: true,            todayBtn: true,            pickSeconds: true,            minuteStep: 10,            language: 'zh-CN'        });    </script>    <script type="text/javascript">        $(function(){            $(".chk").click(function(){                var deploy =$(this).parents("tr").find('.deploy').text();                $.ajax({                    type: "GET",                    url: "{% url 'systack.views.game_log' %}",                    data : {deploy:deploy},                    success: function(data){                        $("#modal-body").html(data);                        $("#ret_table").remove();                        $('#showlog').modal()                    },                    error: function(data){                        var $msg = $("<p>暂无日志</p>");                        $('#modal_body').append($msg);                        $('#showlog').modal()                    }                })            })        })    </script>{% endblock %}