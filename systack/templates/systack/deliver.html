{% extends "systack/base.html" %}{% block title %}SYMainTain_文件分发{% endblock %}{% block mainbar %}    <div class="mainbar">        <div class="page-head">            <h2 class="pull-left"><i class="icon-table"></i>文件分发</h2>            <!-- Breadcrumb -->            <div class="bread-crumb pull-right">                <a href="/"><i class="icon-home"></i> Home</a>                <span class="divider">/</span>                <a href="/deliver" class="bread-current">Deliver</a>            </div>            <div class="clearfix"></div>        </div>        <div class="matter">            <div class="container-fluid">                <!-- Table -->                <div class="row-fluid">                    <div class="span12">                        <div class="widget">                            <div class="widget-head">                                <div class="pull-left">Tables</div>                                <div class="widget-icons pull-right">                                    <a href="#" class="wminimize"><i class="icon-chevron-up"></i></a>                                    <a href="#" class="wclose"><i class="icon-remove"></i></a>                                </div>                                <div class="clearfix"></div>                            </div>                            <div class="widget-content">                                <table class="table table-striped table-bordered table-hover">                                    <thead>                                    <tr>                                        <th>#</th>                                        <th>目标</th>                                        <th>文件</th>                                        <th>分发时间</th>                                        <th>操作者</th>                                        <th>日志</th>                                    </tr>                                    </thead>                                    <tbody>                                    {% if delivers %}                                        {% for list_items in delivers.object_list %}                                            <tr>                                                <td>{{ list_items.id }}</td>                                                <td>{{ list_items.target }}</td>                                                <td>{{ list_items.files }}</td>                                                <td>{{ list_items.mtime|date:"Y-m-d H:i:s" }}</td>                                                <td>{{ list_items.deployed_by }}</td>                                                <td class="jids" style="display: none">{{ list_items.jids }}</td>                                                <td>                                                    <a class="btn btn-info deliver_log"> 查看日志</a>                                                </td>                                            </tr>                                        {% endfor %}                                    {% endif %}                                    </tbody>                                </table>                                <div class="pagination pull-right">                                    <ul>                                        {% if delivers.has_previous  %}                                            <li><a href="?page={{ delivers.previous_page_number }}">Prev</a></li>                                        {% endif %}                                        <li><a href="?page={{ delivers.number }}">{{ delivers.number }}</a></li>                                        {% if delivers.has_next %}                                            <li><a href="?page={{ delivers.next_page_number }}">Next</a></li>                                        {% endif %}                                    </ul>                                </div>                                <div class="clearfix"></div>                                <div class="widget-head">                                    <div class="pull-left">分发文件</div>                                    <div class="clearfix"></div>                                </div>                                <div class="padd">                                    <div class="form quick-post">                                        <!-- Quick setting form (not working)-->                                        <form  class="form-horizontal" action="deliver" method="post">{% csrf_token %}                                            <!-- Name -->                                            <div class="control-group">                                                <label class="control-label" for="target">目标</label>                                                <div class="controls">                                                    <input type="text" class="input-xlarge" id="target" placeholder="目标" name="target">                                                </div>                                            </div>                                            <div class="control-group">                                                <label class="control-label" for="modal">上传文件</label>                                                <div class="controls">                                                    <a href="#myModal" role="button" class="btn" data-toggle="modal">上传文件</a>                                                </div>                                            </div>                                            <!-- Modal -->                                            <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">                                                <div class="modal-header">                                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>                                                    <h3 id="myModalLabel">上传文件</h3>                                                </div>                                                <div class="modal-body">                                                    <input id="file_upload" type="file" name="file_upload" />                                                    <a class="btn btn-primary" type="button" href="javascript:$('#file_upload').uploadify('upload','*')">上传文件</a>                                                    <a class="btn btn-primary" type="button" href="javascript:$('#file_upload').uploadify('cancel', '*')">清空队列</a>                                                </div>                                                <div class="modal-footer">                                                    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>                                                </div>                                            </div>                                            <div class="control-group">                                                <label class="control-label" for="files">文件</label>                                                <div class="controls">                                                    <textarea class="input-xxlarge" id="files" placeholder="请填写要分发更新的文件" name="files"></textarea>                                                </div>                                            </div>                                            <!-- Buttons -->                                            <div class="form-actions">                                                <!-- Buttons -->                                                <button type="submit" class="btn btn-info" value="submit">提交</button>                                                <button type="reset" class="btn">重置</button>                                            </div>                                        </form>                                    </div>                                </div>                            </div>                        </div>                    </div>                </div>            </div>        </div>    </div>    <!-- deliver modal event -->    <div id="deliver_log" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">        <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>            <h3 id="myModalLabel">日志</h3>        </div>        <div>            <div id="modal-body" class="modal-body">                <p>暂没有日志哦！</p>            </div>        </div>        <div class="modal-footer">            <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>        </div>    </div>{% endblock %}{% block js %}    <script type="text/javascript">        $(function(){            $(".deliver_log").click(function(){                var jids =$(this).parents("tr").find('.jids').text();                $.ajax({                    type: "GET",                    url: "{% url 'systack.views.get_log' %}",                    data : {conf_jids:jids,queue_id:'salt.db.return'},                    success: function(data){                        $("#modal-body").html(data);                        $('#deliver_log').modal()                    },                    error: function(data){                        $('#deliver_log').modal()                    }                })            })        })    </script>{% endblock %}